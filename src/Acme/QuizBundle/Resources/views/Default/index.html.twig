{% extends '::base.html.twig' %}

{% block body %}
<div class="container">
    
    <h1>Quiz</h1>
    
    {% if qa is not empty %}

        <p>Single or multiple answers for each question. {{ pagination.getTotalItemCount }} questions available</p>

        <div>Order by {{ knp_pagination_sortable(pagination, 'Id', 'qq.id') }} - {% if pagination.isSorted('qq.question') %}{% endif %}{{ knp_pagination_sortable(pagination, 'Question', 'qq.question') }}</div>

        <div class="navigation">
            {{ knp_pagination_render(pagination) }}
        </div>
    
        {% for question in qa %}
        <form action="" method="post" id="frm_question_{{ question.id }}">
            <p class="pull-right"><strong>{{ question.id }}</strong></p>
            <p><strong>{{ question.question }}</strong></p>
            {% if question.questionCodePart|length > 0 %}
            <pre>{{ question.questionCodePart|escape('html') }}</pre>
            {% endif %}
            
            {% set answer_number = 1 %}
            {% for answer in question.answers %}
                
                {% if question.numberCorrectAnswers > 1 %}
                <div>
                    <label class="normalweight" for="answer_{{ answer.id }}">
                        {{ answer_number }}. <input type="checkbox" name="answer_{{ answer.id }}" id="answer_{{ answer.id }}" value="1"{% if answer.correct == 1 %} correct="correct"{% endif %}> {{ answer.answer }}
                    </label>
                </div>
                {% else %}
                <div>
                    <label class="normalweight" for="answer_{{ answer.id }}">
                        {{ answer_number }}. <input type="radio" name="answer" id="answer_{{ answer.id }}" value=""{% if answer.correct == 1 %} correct="correct"{% endif %}> {{ answer.answer }}
                    </label>
                </div>
                {% endif %}
                {% set answer_number = answer_number + 1 %}
            {% endfor %}
            <p class="text-right">Choose {{ question.numberCorrectAnswers }} answers</p>
            
            <p class="text-center"><button class="btn btn-primary" type="button" onclick="{% if question.numberCorrectAnswers > 1 %}solve_checkbox('frm_question_{{ question.id }}', 'comment_{{ question.id }}'){% else %}solve_radio('frm_question_{{ question.id }}', 'comment_{{ question.id }}'){% endif %}">Solve</button></p>
            
            <div id="comment_{{ question.id }}"{% if question.comment %} class="alert alert-info"{% endif %} style="display: none">{{ question.comment }}</div>
            <hr>
        </form>
        {% endfor %}

    <div class="navigation">
        {{ knp_pagination_render(pagination) }}
    </div>
    
    {% else %}
        <div class="alert alert-warning">
            <h2>No questions</h2>
            <p>Sorry, no questions are available for now :(</p>
        </div>
    {% endif %}
    
<hr>

<div>2014 <a href="http://www.andreafiori.net" title="Andrea Fiori's website" target="_blank">Andrea Fiori</a></div>

</div>

<script>

function solve_checkbox(formId, comment)
{
    checkCorrectAnswer( $("#"+formId+" input:checkbox"), comment );
}

function solve_radio(formId, comment)
{
    checkCorrectAnswer( $("#"+formId+" input:radio"), comment );
}

    function checkCorrectAnswer(selector, comment) {

        /* Uncheck all answers */
        selector.each(function( i ) {
            this.checked = false;
        });

        /* Check correct answers */
        if ( selector.length > 0 ) {
            selector.each(function( i ) {
                if (this.getAttribute('correct') === 'correct') {
                    this.checked = true;
                }
            });
        }
        
        /* Show answer comment */
        $('#'+comment).show();
  
    }

</script>
{% endblock %}